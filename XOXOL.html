<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ХОХОЛ</title>
    <style>
        #display {
            font-weight: bold;
            background-color: yellow;
            color: blue;
            text-align: center;
            font-size: 150pt;
        }
    </style>
</head>

<body>

    <canvas id="myCanvas" width="800" height="510" style="border:1px solid #000000;">
    </canvas>
    <div>
        <button onclick="reset()">Reset</button>
    </div>
    <div id="display"></div>

    <script>
        let keysPressed = {};
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var display = document.getElementById("display");

        var delataYPlatform = 2;
        var platform1 = {
            x: 0,
            y: 0,
            width: 10,
            height: 70,
            movePaddleUp: function () {
                if (platform1.y !== 0) {
                    platform1.y += -delataYPlatform
                }
            },
            movePaddleDown: function () {
                if (platform1.y + platform1.height < canvas.height) {
                    platform1.y += delataYPlatform
                }
            }
        };
        var platform2 = {
            x: canvas.width - 10,
            y: 0,
            width: 10,
            height: 70,
            movePaddleUp: function () {
                if (platform2.y !== 0) {
                    platform2.y += -delataYPlatform
                }
            },
            movePaddleDown: function () {
                if (platform2.y + platform2.height < canvas.height) {
                    platform2.y += delataYPlatform
                }
            }
        };
        var ball = {
            size: 8,
            x: 400,
            y: 250
        };
        var delta = {
            x: 1,
            y: 1
        };


        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            executeMoves();
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, 8, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.rect(platform1.x, platform1.y, platform1.width, platform1.height);
            ctx.rect(platform2.x, platform2.y, platform2.width, platform2.height);
            ctx.fill();
            ball.x += delta.x;
            ball.y += delta.y;
            if (ball.x === canvas.width - ball.size) {
                delta.x = -1;
            }
            if (ball.x === 0 + ball.size) {
                delta.x = 1;
            }
            if (ball.y === canvas.height - ball.size) {
                delta.y = -1;
            }
            if (ball.y === 0 + ball.size) {
                delta.y = 1;
            }
            if ((ball.y < platform1.y || ball.y > platform1.y + platform1.height) && ball.x === ball.size) {
                console.log("Ты лох");
                clearInterval(interval);
                display.innerHTML = "Миша ЛОХ 1 <br> проиграл ";
            }
            if ((ball.y < platform2.y || ball.y > platform2.y + platform1.height) && ball.x === canvas.width - ball.size) {
                console.log("Ты лох");
                clearInterval(interval);
                display.innerHTML = "Миша ЛОХ 2 <br> проиграл ";
            }
        }

        const controller = {
            87: { pressed: false, func: platform1.movePaddleUp },
            83: { pressed: false, func: platform1.movePaddleDown },
            38: { pressed: false, func: platform2.movePaddleUp },
            40: { pressed: false, func: platform2.movePaddleDown },
        }

        document.addEventListener("keydown", (e) => {
            if (controller[e.keyCode]) {
                controller[e.keyCode].pressed = true
            }
        })
        document.addEventListener("keyup", (e) => {
            if (controller[e.keyCode]) {
                controller[e.keyCode].pressed = false
            }
        })

        document.addEventListener("keydown", (e) => {
            if (e.keyCode === 82) {
                reset();
            }
        })

        const executeMoves = () => {
            Object.keys(controller).forEach(key => {
                controller[key].pressed && controller[key].func()
            })
        }

        let interval = setInterval(render, 3);

        function reset() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (interval) {
                clearInterval(interval);
            }
            interval = setInterval(render, 3);

            display.innerHTML = '';
            ball.x = 400;
            ball.y = 250;
        }

    </script>

</body>

</html>